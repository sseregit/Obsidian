# 로그 분석 중앙화

## 문제점
- 일반적으로 애플리케이션을 실행하고 있는 서버의 로컬 파일시스템에 애플리케이션 로그이벤트를 기록한다. 하지만 여러개의 소규모 서버에 다수의 마이크로서비스 인스턴스를 배포하는 마이크로서비스 아키텍처 기반의 시스템 환경에서는 다음과 같은 문제가 있다.

1. 각 마이크로서비스 인스턴스가 로컬에 로그 파일을 기록하는 상황에서 전체 시스템 환경에서 발생하는 사건을 개괄하려면 어떻게 해야 하는가?
2. 문제가 발생한 마이크로서비스 인스턴스를 찾아서 로그 파일에 오류 메시지를 쓰게 하려면 어떻게 해야 하는가?
3. 최종 사용자가 문제를 보고했을 때 이와 관련된 로그 메시지를 찾으려면 어떻게 해야 하는가? 문제의 근본 원인이 되는 마이크로서비스 인스턴스를 찾으려면 어떻게 해야 하는가?
## 해결책
- 다음과 같은 기능을 갖추고 **로그를 중앙화**해 관리하는 새 컴포넌트를 추가한다.
- 새 마이크로서비스 인스턴스를 감지해 로그 이벤트를 수집
- 로그 이벤트를 해석해 구조적이고 검색 가능한 형식으로 중앙 데이터베이스에 저장
- 로그 이벤트를 조회 및 분석하기 위한 API와 그래픽 도구를 제공
### 해결책의 필요 조건
- 마이크로서비스는 로그 이벤트를 [[표준 시스템 출력?]], [[stdout?]]으로 보낸다. 이렇게 하면 각 마이크로서비스의 로그 파일에 로그 이벤트를 기록하는 것에 비해 수월하게 로그 수집기가 로그 이벤트를 찾을 수 있다.
- 마이크로서비스는 로그 이벤트는 상관 ID를 삽입한다.
- 표준 로그 형식을 정의하면 로그 이벤트를 중앙 데이터베이스에 저장하기 전에 로그 수집기가 마이크로서비스에서 수집한 로그 이벤트를 표준 로그 형식으로 변환할 수 있다. 로그 이벤트를 표준 로그 형식으로 저장해야 수집한 로그 이벤트를 질의하고 분석할 수 있다.