# 섹션 1. 들어가며

## 강의 소개

## 대규모 시스템 서버 인프라 기초

## 강의자료 다운로드

## 시스템 아키텍처 - Monolithic Architecture

## 시스템 아키텍처 - Microservice Architecture

## Docker

## Spring Boot 프로젝트 세팅 1

## Spring Boot 프로젝트 세팅 2
---

# 섹션 2. 게시글

## Distributed Relational Database
- 샤딩 (Sharding)
	- 데이터를 여러 데이터베이스에 순산 저장 기술
	- 샤드 (Shard)
		- 샤딩된 각각의 데이터 단위
	- 수직 샤딩
		- 데이터를 수직으로 분할 (컬럼 단위)
	- 수평 샤딩
		- 데이터를 수평으로 분할하는 방식 (행 단위)
	- 범위 기반 샤딩 (Range-based-Sharding)
		- 데이터를 특정값(ShardKey)의 특정범위에 따라 분할
	- 해시기반 샤딩 (Hash-based Sharding)
		- 데이터를 특정값(Shard key)의 해시함수로 분할
## MySQL 개발 환경 세팅
## 게시글 CRUD API 설계
## Snowflake
- snowflake
	- X 개발
	- 분산시스템에서 고유한 64비트 ID를 생성하는 알고리즘
	- [1bit][41bit:timestamp][10bit:Nodeid][12bit:시퀀스번호]
## 게시글 CRUD API 구현
## 게시글 테스트 데이터 삽입
## 게시글 목록 API - 페이지 번호 - N번 페이지 M개 게시글 - 설계
- 인덱스
	- 데이터를 빠르게 찾기위한 방법
	- Clustered Index (PK)
		- leaf node의 값으로 행 데이터를 가진다.
	- Secondary Index (보조 인덱스)
		- leaf node에 인덱스 컬럼데이터,데이터에 접근하기위한 포인트럴 가진다.
	- Covering Index
		- 인덱스만으로 쿼리의 모든 데이터를 처리할 수 있는 인덱스
		- Clustered Index를 읽지않고 Secondary Index포함된 정보만으로 쿼리가능한 인덱스
## 게시글 목록 API - 페이지 번호 - 게시글 개수 - 설계
## 게시글 목록 API - 페이지 번호 구현
## 게시글 목록 API - 무한 스크롤 설계
## 게시글 목록 API - 무한 스크롤 구현
## Primary Key 생성 전략
- auto-increment
	- 분산환경 적합하지 않다.
- 유니크 문자열 or 숫자
	- 랜덤으로 인한 성능 저하
- 유니크 정렬 문자열
- 유니크 정렬 숫자
	- Snowflake, TSID 64bit
---
# 섹션 3. 댓글

## 댓글 최대 2 depth - 테이블 설계
## 댓글 최대 2 depth - CUD API 구현
## 댓글 최대 2 depth - CUD API 테스트 & 테스트 데이터 삽입
## 댓글 최대 2 depth - 목록 API 설계
## 댓글 최대 2 depth - 목록 API 구현
- Covering index로 범위를 줄인뒤 Clustered Index로 조회한다.
## 댓글 무한 depth - 테이블&구현 설계
- Path Enumeration (경로 열거)
	- DB의 collation 설정
		- 컬럼,테이블,데이터베이스 설정 가능
		- [utf8mb64_0900_ai_ci]
			- utf8mb64
				- 각 문자최대 4바이트 utf8 지원
			- 0900
				- 정렬 방식 버전
			- ai
				- 악센트 비구분
			- ci
				- 대소문자 비구문
- Backward index scan
	- 인덱스를 역순으로 스캔하는것
	- 인덱스트리 leaf node 간에 연결된 양방향 포인터를 활용한다.
## 댓글 무한 depth - CUD API 구현 & 테스트 데이터 삽입
## 댓글 무한 depth - 목록 API 구현
---
# 섹션 4. 좋아요
## 좋아요 설계
## 좋아요 구현
## 좋아요 수 설계 - 테이블 정의
- Record Lock
	- 행 잠금
		- 여러 프로세스는 스레드가 자원에 동시에 접근하는 경쟁상태를 방지하기위해 제한을 거는것
## 좋아요 수 설계 - 동시성 문제
- 비관적 락 (Pessimistic Lock)
	- 항상 충돌이 발생한다는 가능성이 있다고 가정
	- 데이터보호를 위한 항상 락을 건다.
- 낙관적 락 (Optimistic Lock)
	- 항상 충돌이 발생하지 않는다 가정
	- 데이터 변경 여부를 확인하여 충돌을 처리한다.
	- 후 처리 작업 필요
- 비동기 순차 처리
	- 모든 상황을 실시간으로 처리하고 즉시 응답해줄 필요가 없다는 관점
## 좋아요 수 구현
## 게시글 수&댓글 수 설계
## 게시글 수 구현
## 댓글 수 구현
---
# 섹션 5. 조회수
## 조회수 설계 & Redis 개발 환경 세팅
## 조회수 구현
## 조회수 어뷰징 방지 정책 설계
## 조회수 어뷰징 방지 정책 구현
---
# 섹션 6. 인기글
## Kafka Cluster
- Producer
	- Kafka로 데이터를 보내는 Client
	- 데이터 생산 및 전송
	- Topic단위 데이터 전송
- Consumer
	- Kafka에서 데이터를 읽는 클라이언트
	- 데이터 소비 및 처리
	- Topic단위 구독 데이터 처리
- Broker
	- Kafka에서 데이터를 중개 및 처리해주는 애플리케이션 실행단위
	- Producer,Consumer 사이에서 데이터를 주고받는 역할
- Kafka Cluster
	- 여러개의 broker가 모여서 하나의 분산형 시스템을 구성
	- 대규모데이터에 대해 고성능, 안전성, 확장성, 고가용성을 지원
		- 데이터시 복제, 분산처리, 장애 복구등
- Topic
	- 데이터가 구분되는 논리적인 단위
- Partition
	- Topic이 분산되는 단위
	- 각 Partition 내에서 데이터가 순차적으로 기록되므로, Partition간에는 순서가 보장되지 않는다.
- Offset
	- 각 데이터의 공유한 위치
	- Consumer Group은 각 그룹이 처리한 Offset을 관리한다.
- Consumer Group
	- 각 Topic의 Partition 단위로 offset을 관리한다.
	- Group내의 Consumer들은 데이터를 중복해서 읽지 않을수 있다.
	- Group별로 데이터를 병렬처리 할 수 있다.
## Kafka 개발 환경 세팅
## 인기글 Consumer 설계
- Stream
	- 연속적인 데이터 흐름
	- 실시간으로 발생하는 로그, 센서 감지, 주식거래 데이터등과 같이 연속적으로 들어오는 데이터
- Stream Processing
	- 스트림을 처리하는것
	- 연속적으로 들어오는 실시간 데이터를 처리하는 방식
## Event&직렬화 모듈 구현
## 인기글 Consumer 구현 - 설정 및 인기글 리포지토리
## 인기글 Consumer 구현 - 이벤트 데이터 리포지토리
## 인기글 Consumer 구현 - 이벤트 핸들러 및 서비스 레이어
## 인기글 Consumer 구현 - 컨트롤러&컨슈머 작성
## 인기글 Producer 설계 - Transactional Messaging
- Transactional Messaging
	- 데이터의 일관성, 원자성 관리를 위해 트랜잭션 관리는 중요하다.
	- 메시지 전송과 타시스템 작업간에 분산트랜잭션을 보장하는 방법
	- Two Phase Commit
		- 분산시스템에서 모든시스템이 하나의 트랜잭션을 수행할 때
		- Prepare Phase (준비단계)
			- Coordinator는 각 참여자에게 트랜잭션을 커밋할 준비가 되있는지 묻는다.
		- Commit Phase (커밋단계)
			- 모든 참여자가 응답을 보내면 Coordinator는 모든 참여자에게 트랜잭션 커밋을 요청한다.
			- 모든 참여자는 트랜잭션을 커밋한다.
	- Transactional Outbox
		- 이벤트 전송작업을 일반적인 데이터베이스 트랜잭션에 포함시킬 수 없다
		- 하지만 이벤트 전송 정보를 데이터베이스 트랜잭션에 포함하여 기록할 수 있다.
		- Message Relay
			- Message Broker로 이벤트를 전송하는 역할
	- Transaction Log Tailing
		- 데이터베이스의 트랜잭션로그를 추적 및 분석한느 방법
		- CDC (Change Data Capture)
			- 데이터 변경사항을 추적한느 기술
- Distributed Transaction
	- 분산시스템에서 트랜잭션을 보장하기 위한 방법
## Transactional Outbox 모듈 구현
## Transactional Outbox 모듈 적용
## Transactional Outbox 테스트
## 인기글 Producer&Consumer 테스트
---
# 섹션 7. 게시글 조회 최적화
## CQRS의 필요성
## CQRS 개념 & 게시글 조회 단건 최적화 전략 설계
- CQRS (Command Query Responsibility Segregation)
	- Command와 Query의 책임 분리
## 게시글 조회 서비스 설정 & Client & QueryModel
## 게시글 조회 최적화 구현 - 이벤트 핸들러 및 서비스 레이어
## 게시글 조회 최적화 구현 - 조회수 캐시
## 게시글 조회 최적화 구현 - Consumer & Controller
## 게시글 조회 최적화 전략 구현 - 테스트
## 게시글 목록 최적화 전략 설계
- hot data
	- 자주 조회되는 데이터
- cold data
	- 자주 조회되지않는 데이터
## 게시글 목록 최적화 전략 구현 - Long&Double 학습 테스트
- long은 64비트 정수, Double 64비트 부동 소수점
	- 형변환시 데이터 유실가능성이 높다.
## 게시글 목록 최적화 전략 구현 - 리포지토리
## 게시글 목록 최적화 전략 구현 - 서비스 & 컨트롤러
## 게시글 목록 최적화 전략 구현 - 테스트
## 캐시 최적화 전략 설계 - 기존 캐시 전략의 제약
## 캐시 최적화 전략 설계 - Request Collapsing
- Request Collapsing
	- 여러개의 동일하거나 유사한 요청을 하나의 요청으로 병합하여 처리하는 기법
## 캐시 최적화 전략 구현 - Request Collapsing
## 캐시 최적화 전략 구현 - 테스트
---
# 섹션 8. 마치며
## 셀프 코드 리뷰
## 마치며
