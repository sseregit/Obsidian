# 도커의 캐싱 메커니즘
- Dockerfile을 기반으로 이미지를 빌드할 때, 각 명령어(`RUN`, `COPY`, `ADD`등)를 실행한 결과를 **레이어(layer)** 로 저장하여, 동일한 명령어가 다시 실행될 때 이전에 생성된 레이어를 재사용함으로써 빌드 시간을 단축하는 방식이다.
### 동작 원리
1. 명령어 실행 및 레이어 생성
	- Dockerfile의 각 명령어는 실행 결과를 새로운 레이어로 생성한다.
2. 캐시 확인
	- 도커는 각 명령어를 실행하기 전에 이전에 동일한 명령어로 생성된 레이어가 있는지 확인한다.
3. 캐시 사용 또는 레이어 생성
	- 동일한 레이어가 존재하면 해당 레이어를 캐시에서 가져와 재사용하고, 없으면 명령어를 실행하여 새로운 레이어를 생성한다.
### 이점
- 빌드 시간 단축
	- 변경되지 않은 부분은 캐시를 활용하여 재사용하므로, 전체 빌드 시간을 크게 줄일 수 있다.
- 일관성 유지
	- 동일한 Dockerfile로 빌드할 때마다 일관된 이미지를 생성할 수 있다.
### 캐시 무효화의 발생 요인
- 명령어 변경
	- Dockerfile의 명령어가 수정되면 해당 명령어 이후의 모든 레이어 캐시가 무효화되어 다시 빌드된다.
- 파일 변경
	- `COPY`나 `ADD` 명령어로 복사되는 파일의 내용이 변경되면 해당 레이어의 캐시가 무효화 된다.
### 최적화 전략
- 변경 빈도에 따른 명령어 순서 조정
	- 변경이 적은 명령어를 상단에, 변경이 잦은 명령어를 하단에 배치하여 캐시 활용을 극대화 한다.
- 멀티스테이지 빌드 활용
	- 빌드 단계와 최종 이미지를 분리하여 불필요한 파일이나 레이어를 포함하지 않도록 구성한다.
### 주의사항
- 외부 리소스 의존성 관리
	- 외부에서 가져오는 파일이나 패키지의 버전이 변경되면 캐시가 무효화될 수 있으므로, 버전을 명시적으로 지정하여 예측 가능한 빌드를 유지해야 한다.