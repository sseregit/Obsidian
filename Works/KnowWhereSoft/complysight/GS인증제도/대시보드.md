# 보고서 제출율
- (당일 제출된 보고서 수 / **당일** 기준 점검된 횟수 * 100%)
# 수집커버리지
- (당일 정상 점검된 항목 / **당일** 기준 점검된 항목 총 갯수) * 100
# 유효 중적 충촉율
- (당일 정상 점검된 항목 / **당일** 기준 점검된 항목 총 갯수) * 100
	- 필수 항목, 일반 항목 추가시
		- (당일 필수 정상 점검된 항목 / **당일** 기준 필수 점검된 항목 총 갯수) * 100
# 중대미비/기한초과
- 중대미비
	- (당일 실패한 점검항목 수)
	- 필수 항목, 일반 항목 추가시
		- (당일 실패한 필수 점검항목 수)
- 기한초과
	- 0건
		- 마감일의 개념이 확실해질 때 적용
---
# 보고서 제출율, 수집커버리지, 유효증적 충촉율 막대 그래프
- 위의 데이터 활용
---
# 정보시스템별 등록한 서버점검 %
- N개의 정보시스템별 (당일 정상 점검된 정보시스템 항목 / **당일** 기준 점검된 정보시스템 항목 총 갯수) * 100
	- 0% 없음
	- 20% 미비
	- 80% 주의
	- 100% 완료
---
# 오류사항 정보 제공 추이
- 매일 N개의 정보시스템별 (실패한 항목 건 수)
	- 정보시스템별 색상을 다르게
---
# 보고서 제출 추이
- 매일 N개의 정보시스템별 (보고서 보고 갯수)
	- 정보시스템별 색상을 다르게
---

# SQL
- 당일 제출된 보고서 수
```sql
select count(1)
from asset_inspection_result
where submit_dtm is not null
  and report_content is not null
  and reg_dtm >= CURRENT_DATE
  and reg_dtm < CURRENT_DATE + INTERVAL '1 day'
group by contract_id, asset_id, grp_cd, report_type, version
```
- 당일 기준 점검된 횟수
```sql
select count(1)
from asset_inspection_result
WHERE reg_dtm >= CURRENT_DATE
  AND reg_dtm < CURRENT_DATE + INTERVAL '1 day'
group by contract_id, asset_id, grp_cd, report_type, version  
```
- 당일 정상 점검된 항목
```sql
select count(1)
from asset_inspection_result
where result = ‘true’
and reg_dtm >= CURRENT_DATE
and reg_dtm < CURRENT_DATE + INTERVAL '1 day'  
```
- 당일 기준 점검된 항목 총 갯수
```sql
select count(1)
from asset_inspection_result
where reg_dtm >= CURRENT_DATE
and reg_dtm < CURRENT_DATE + INTERVAL '1 day'  
```
- 당일 실패한 점검항목 수
```sql
select count(1)
from asset_inspection_result
where result = ‘false’
and reg_dtm >= CURRENT_DATE
and reg_dtm < CURRENT_DATE + INTERVAL '1 day'  
```
- 당일 정상 점검된 정보시스템 항목
```sql
-- 서버예시
select count(1)
from asset_inspection_result air
join inspection_code_group icg on icg.grp_cd = air.grp_cd
where icg = ‘SV’ -- {‘SV’ 서버, ‘WB’ WEB, ‘WS’ WAS, ‘DB’ DB} 각각 query를 날려야한다.
and result = ‘true’
and reg_dtm >= CURRENT_DATE
and reg_dtm < CURRENT_DATE + INTERVAL '1 day'  
```
-  당일 기준 점검된 정보시스템 항목 총 갯수
```sql
-- 서버예시
select count(1)
from asset_inspection_result air
join inspection_code_group icg on icg.grp_cd = air.grp_cd
where icg = ‘SV’ -- {‘SV’ 서버, ‘WB’ WEB, ‘WS’ WAS, ‘DB’ DB} 각각 query를 날려야한다.
and reg_dtm >= CURRENT_DATE
and reg_dtm < CURRENT_DATE + INTERVAL '1 day'  
```
---
- 매일 ex) 20251225 를 기준으로 계속 데이터를 쌓으면서 당일 데이터는 update 되어야 한다.
- 테이블 설계필요
```sql
create table inspection_daily_system_fact (
    stat_date              date         not null, -- 통계 기준일 (일 단위)
    system_id              bigint       not null, -- 정보시스템 ID (system_mg.id)
    report_type            varchar(16)  not null, -- 보고서 종류 (cm_dts_cd.grp_cd = ‘SM110’ and dts_cd = report_type 예: SV, WB, WS, DB 등)
    required_level         varchar(16)  not null, -- 'REQUIRED', 'OPTIONAL' 등

    -- 기본 카운트
    inspected_count        bigint       not null default 0, -- 점검된 항목 수(성공+실패)
    success_count          bigint       not null default 0, -- 정상 점검된 항목 수
    failure_count          bigint       not null default 0, -- 실패한 점검 항목 수
    report_submitted_count bigint       not null default 0, -- 제출된 보고서 수

    -- 선택 카운트 (확장)
    target_count           bigint       not null default 0, -- 점검 대상 항목 수(옵션)
    overdue_failure_count  bigint       not null default 0, -- 기한초과 실패 항목 수(옵션)
    critical_failure_count bigint       not null default 0, -- 중대미비(치명적) 실패 항목 수(옵션)

    -- 메타
    last_agg_dtm           timestamp(6) not null default now(),

    constraint pk_inspection_daily_system_fact
        primary key (stat_date, system_id, report_type, required_level),

    constraint fk_inspection_daily_system_fact_system
        foreign key (system_id) references system (id)
);

comment on table inspection_daily_system_fact
    is '정보시스템/보고서종류/필수여부 단위 일간 점검 집계 팩트 테이블';

comment on column inspection_daily_system_fact.stat_date
    is '통계 기준일 (일 단위)';

comment on column inspection_daily_system_fact.system_id
    is '정보시스템 ID (system.id 참조)';

comment on column inspection_daily_system_fact.report_type
    is '보고서 종류 코드 (예: SV, WB, WS, DB 등)';

comment on column inspection_daily_system_fact.required_level
    is '점검 필수 여부 (REQUIRED/OPTIONAL 등)';

comment on column inspection_daily_system_fact.inspected_count
    is '당일 점검된 항목 수 (성공 + 실패)';

comment on column inspection_daily_system_fact.success_count
    is '당일 정상 점검된 항목 수';

comment on column inspection_daily_system_fact.failure_count
    is '당일 실패한 점검 항목 수';

comment on column inspection_daily_system_fact.report_submitted_count
    is '당일 제출된 보고서 수';

comment on column inspection_daily_system_fact.target_count
    is '당일 기준 점검 대상 항목 수 (원하면 사용)';

comment on column inspection_daily_system_fact.overdue_failure_count
    is '마감일 초과된 실패 항목 수 (마감 개념 도입 시 사용)';

comment on column inspection_daily_system_fact.critical_failure_count
    is '중대미비(치명적)로 분류된 실패 항목 수';

comment on column inspection_daily_system_fact.last_agg_dtm
    is '마지막 집계/갱신 시각';
```

## 참고 테이블
```sql
create table cm_dts_cd
(
    dts_cd     varchar(255) not null,
    grp_cd     varchar(255) not null,
    chg_dtm    timestamp(6),
    chg_id     varchar(255),
    dts_cd_eng varchar(255),
    dts_cd_epl varchar(255),
    dts_cd_nm  varchar(255),
    dts_order  integer,
    ref1       varchar(255),
    ref2       varchar(255),
    reg_dtm    timestamp(6),
    reg_id     varchar(255),
    use_yn     varchar(255),
    primary key (dts_cd, grp_cd)
);

alter table cm_dts_cd
    owner to complysight;
테이블 미리보기 표시  
```
```sql
create table system_mg
(
    id           bigserial
        primary key,
    system_no    varchar(50),
    system_dtm   varchar(8),
    system_sdtm  varchar(8),
    system_edtm  varchar(8),
    system_nm    varchar(100),
    system_type  varchar(10),
    system_owner varchar(10),
    system_ctrl  varchar(10),
    del_yn       varchar(1),
    mnt_dpt      varchar(50),
    mnt_usr      varchar(50),
    it_dpt       varchar(50),
    it_usr       varchar(50),
    reg_id       varchar(15),
    reg_dtm      timestamp,
    chg_id       varchar(15),
    chg_dtm      timestamp,
    m_etc        varchar(5000)
);

comment on table system_mg is '정보시스템 관리';

comment on column system_mg.id is '정보시스템ID';

comment on column system_mg.system_no is '관리번호';

comment on column system_mg.system_dtm is '운영 일자';

comment on column system_mg.system_sdtm is '운영시작일자';

comment on column system_mg.system_edtm is '운영종료일자';

comment on column system_mg.system_nm is '정보시스템명';

comment on column system_mg.system_type is '유형';

comment on column system_mg.system_owner is '정보시스템 관리주체';

comment on column system_mg.system_ctrl is '수행사';

comment on column system_mg.del_yn is '삭제 여부';

comment on column system_mg.mnt_dpt is '업무담당부서';

comment on column system_mg.mnt_usr is '업무담당자';

comment on column system_mg.it_dpt is 'IT 담당부서';

comment on column system_mg.it_usr is 'IT 담당자';

comment on column system_mg.reg_id is '등록자ID';

comment on column system_mg.reg_dtm is '등록일자';

comment on column system_mg.chg_id is '변경자ID';

comment on column system_mg.chg_dtm is '변경일시';

comment on column system_mg.m_etc is '기타';

alter table system_mg
    owner to complysight;
```